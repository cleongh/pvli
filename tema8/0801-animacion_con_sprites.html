<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Animación con sprites</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">



  <!-- <link rel="stylesheet" href="../shared/lib/reveal/../tabzilla/css/tabzilla.css"/> -->
  <link rel="stylesheet" href="../shared/lib/reveal/css/reveal.css"/>
  <link rel="stylesheet" href="../shared/lib/reveal/css/theme/mozilla-devrel-light.css"/>
  <link rel="stylesheet" href="../shared/lib/reveal/lib/css/solarized-light.css" />




  <!-- <link rel="stylesheet" href="../shared/lib/reveal/css/reveal.css"> -->

  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.bn { color: #40a070; } /* BaseN */
code span.fl { color: #40a070; } /* Float */
code span.ch { color: #4070a0; } /* Char */
code span.st { color: #4070a0; } /* String */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.ot { color: #007020; } /* Other */
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.fu { color: #06287e; } /* Function */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #880000; } /* Constant */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.ss { color: #bb6688; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #19177c; } /* Variable */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.op { color: #666666; } /* Operator */
code span.bu { } /* BuiltIn */
code span.ex { } /* Extension */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.at { color: #7d9029; } /* Attribute */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
<!--  -->
<!--   <link rel="stylesheet" href="../shared/lib/reveal/css/theme/black.css" id="theme"> -->
<!--  -->
<!--  -->
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../shared/lib/reveal/css/print/pdf.css' : '../shared/lib/reveal/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="../shared/lib/reveal/lib/js/html5shiv.js"></script>
  <![endif]-->


<!-- FIXME megahack because `pandoc` only generates h1's. -->
<!-- <style type="text/css"> -->


<!-- .inner { -->
<!--     width: 100%; -->
<!--     margin: 0 auto; --> 
<!-- } -->

<!--     h1{ --> 
<!--     } -->

<!--     .level2 h1 { -->
        
<!--     border-top: 0.1em solid #484848; -->
<!--     border-bottom: 0.1em solid #484848; -->
    
<!--     padding: 1em 0; -->
<!--     margin-bottom: 1em; -->
<!--     font-size: 1.6em; -->
<!--     margin: 0 0 20px 0; -->
<!--     color: #484848; -->
<!--     font-family: "Fira Sans", Helvetica, sans-serif; -->
<!--     font-weight: 600; -->
<!--     line-height: 1.2; -->
<!--     letter-spacing: normal; -->
<!--     text-transform: uppercase; -->
<!--     text-shadow: none; -->
<!--     word-wrap: break-word; -->
<!-- } -->

<!-- </style> -->


</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
  <h1 class="title">Animación con sprites</h1>
</section>

<section><section id="el-pasado" class="title-slide slide level1"><h1>El pasado</h1></section><section class="slide level2">

<p>El <a href="https://es.wikipedia.org/wiki/Alma">alma</a>, se creía/cree, es eso que tenemos y que nos hace movernos</p>
</section><section class="slide level2">

<p>Alma en latín se dice <code>anima</code></p>
</section><section class="slide level2">

<p><em>Animar</em> es dar <em>alma</em>, dar <em>movimiento</em></p>
</section></section>
<section><section id="el-siglo-xix" class="title-slide slide level1"><h1>El siglo XIX</h1></section><section class="slide level2">

<p><a href="https://en.wikipedia.org/wiki/Eadweard_Muybridge">Eadweard Muybridge</a> diseñó un sistema de fotografía en el que, haciendo muchas fotos seguidas con una cámara fija, conseguía que el ojo human no pudiera distinguir los fotogramas como imágenes separadas</p>
<p>Sino como <em>movimiento</em></p>
</section><section class="slide level2">

<figure>
<img data-src="https://upload.wikimedia.org/wikipedia/commons/7/73/The_Horse_in_Motion.jpg" alt="The Horse in Motion (Wikipedia)" /><figcaption>The Horse in Motion (Wikipedia)</figcaption>
</figure>
</section><section class="slide level2">

<figure>
<img data-src="https://upload.wikimedia.org/wikipedia/commons/0/07/The_Horse_in_Motion-anim.gif" alt="The Horse in Motion animado (Wikipedia)" /><figcaption>The Horse in Motion animado (Wikipedia)</figcaption>
</figure>
</section><section class="slide level2">

<p>Con la misma idea, los <a href="https://es.wikipedia.org/wiki/Hermanos_Lumi%C3%A8re">Hermanos Lumière</a> inventaron el cinematógrafo</p>
</section></section>
<section><section id="hoy" class="title-slide slide level1"><h1>Hoy</h1></section><section class="slide level2">

<p>La idea prácticamente no ha variado</p>
<p>Para crear la <strong>sensación</strong> de movimiento (animación), reproducimos imágenes en orden, suficientemente rápido</p>
</section></section>
<section><section id="sprites" class="title-slide slide level1"><h1>Sprites</h1></section><section class="slide level2">

<p>Un <a href="https://en.wikipedia.org/wiki/Sprite_(computer_graphics)"><em>sprite</em></a> es una imagen sencilla, única, en 2D</p>
</section><section class="slide level2">

<p>Su origen es parte de las historia del videojuego</p>
<p>Algunas de las primeras máquinas dedicadas a correr juegos tenían hardware <em>dedicado</em> para sprites</p>
</section><section class="slide level2">

<p>Por tanto, esta tecnología de sprite no realizaba cambios en RAM que se volcaban al dispositivo gráfico</p>
</section><section class="slide level2">

<p>Esta es una de las razones por las que los sprites tenían restricciones físicas</p>
</section><section class="slide level2">

<p>Hoy en día, generalmente, hacemos la creación de la escena gráfica (<strong>frame</strong>) en la RAM y volcamos (<code class="sourceCode javascript">blit</code>) al contexto gráfico</p>
<p>Esto nos da una flexibilidad enorme, pero es <em>más lento</em></p>
</section><section class="slide level2">

<p>Obviamente, esto en irrelevante en términos de eficiencia con el hardware moderno</p>
</section><section id="sprites-hoy" class="slide level2">
<h2>Sprites hoy</h2>
</section><section class="slide level2">

<p>Hoy en día, los sprites son generalmente mapas de bits de cualquier tamaño</p>
</section><section class="slide level2">

<p>En general, usamos formas rectangulares con formatos (razonablemente) estándar</p>
<p>Dado cómo usamos los sprites, el tamaño o el número de colores ya no es, generalmente, un problema</p>
</section><section class="slide level2">

<p>Solemos usar formatos con transparencia explícita</p>
<p>Para ello hace falta un formato que lo acepte (como PNG)</p>
<figure>
<img data-src="imgs/tux.png" alt="Sprite" /><figcaption>Sprite</figcaption>
</figure>
</section><section class="slide level2">

<p>También (esto depende del formato de la imagen) podemos usar un color concreto de fondo</p>
</section><section class="slide level2">

<p>Esta idea es muy similar a como funciona un <a href="https://es.wikipedia.org/wiki/Croma">croma</a></p>
<figure>
<img data-src="imgs/tux_fondo.png" alt="Sprite" /><figcaption>Sprite</figcaption>
</figure>
</section><section class="slide level2">

<p>Ya hemos cargado y usado sprites, ahora vamos a ver cómo podemos hacer que esos sprites estén animados</p>
</section></section>
<section><section id="muchos-sprites" class="title-slide slide level1"><h1>Muchos sprites</h1></section><section class="slide level2">

<p>Producimos la <em>sensación</em> de animación al reproducir imágenes consecutivas con pequeños cambios secuenciales, <em>suficientemente rápido</em></p>
</section><section class="slide level2">

<p>Para conseguir esto en videojuegos, simplemente disponemos de varios sprites que representan secuencias de movimientos seguidos, diferenciales</p>
<figure>
<img data-src="https://c1.staticflickr.com/5/4147/4998615136_dc0b7b1e39_b.jpg" alt="Spritesheet (https://www.flickr.com/photos/goosemouse/4998615136)" style="width:35.0%" /><figcaption>Spritesheet (https://www.flickr.com/photos/goosemouse/4998615136)</figcaption>
</figure>
</section><section class="slide level2">

<p>Una vez que tenemos la información, simplemente tenemos que usarla para dibujar, en un contexto gráfico, los sprites por orden</p>
<p>De la misma manera que el cine</p>
</section><section class="slide level2">

<p>Para hacer esto de forma que el movimiento, la animación, sea convincente, tenemos que asegurarnos de que el reemplazo de una imagen por la siguiente en la secuencia no tenga “fallos”</p>
</section><section class="slide level2">

<p>Estos requisitos los cumplimos manteniendo propiedades básicas entre las imágenes:</p>
<ul>
<li class="fragment">Mismo tiempo por fotograma</li>
<li class="fragment">Mismo tamaño de fotogramas</li>
<li class="fragment">Mismo fondo</li>
<li class="fragment">Misma paleta de colores</li>
<li class="fragment">Misma información de transparencia</li>
<li class="fragment">Misma localización relativa del sprite en el recuadro</li>
<li class="fragment">Misma escala</li>
</ul>
</section><section class="slide level2">

<p>Si mantenemos esos requisitos (lo cual no es <em>técnicamente</em> necesario), el programa que procese la información para representarla por pantalla podrá ser sencillo</p>
</section><section class="slide level2">

<pre class="sourceCode javascript" id="cb1"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">// asumimos tiempo fijo entre frames</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">// el tamaño y la posición del personaje: fijos</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">var</span> width <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> height <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">var</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">var</span> tiempo_entre_frames <span class="op">=</span> <span class="fl">0.01</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">var</span> frames <span class="op">=</span> [frame1<span class="op">,</span> frame2<span class="op">,</span> frame3<span class="op">,</span> ...<span class="op">,</span> framen]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">var</span> frames_por_ciclo <span class="op">=</span> <span class="va">frames</span>.<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="cf">while</span>(<span class="kw">true</span>) <span class="op">{</span> <span class="co">// repite la animación indefinidamente</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="cf">for</span>(int frame_actual <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> frame_actual <span class="op">&lt;</span> frames_por_ciclo<span class="op">;</span> frame_actual<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">        frame_que_pinto <span class="op">=</span> frames[frame_actual]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        <span class="at">pintar_frame</span>(frame_que_pinto<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> x<span class="op">,</span> y)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        <span class="at">esperar</span>(tiempo_entre_frames)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="op">}</span></a></code></pre>
</section></section>
<section><section id="spritesheets" class="title-slide slide level1"><h1>Spritesheets</h1></section><section class="slide level2">

<p>Es generalmente cómodo y fácil tener todos los frames de una animación en un solo recurso</p>
</section><section class="slide level2">

<p>Podemos usar un atlas de imagen en el que cada imagen sea un frame de la animación</p>
</section><section id="frames" class="slide level2">
<h2><em>Frames</em></h2>
</section><section class="slide level2">

<p>Un frame, como hemos visto, es cada una de las imágenes que serán representadas en una animación</p>
</section><section class="slide level2">

<p>Generalmente se representa cada frame seguido del siguiente</p>
</section><section class="slide level2">

<p>Varios frames forman un <em>ciclo</em></p>
</section><section id="ciclos" class="slide level2">
<h2><em>Ciclos</em></h2>
</section><section class="slide level2">

<p>Un recurso de animación puede contener varios <em>ciclos</em> de animación</p>
<p>Normalmente, una entidad en un videojuego puede hacer varias cosas, de forma que necesitará una animación para representar cada una de ellas</p>
</section><section class="slide level2">

<ul>
<li class="fragment">Andar</li>
<li class="fragment">Saltar</li>
<li class="fragment">Agacharse</li>
<li class="fragment">Disparar</li>
</ul>
</section><section class="slide level2">

<p>Cada una de estas acciones se representa en animación con lo que llamamos <em>ciclo</em></p>
<p>Un ciclo es una secuencia ordenada de frames que representan un movimiento continuo</p>
</section><section class="slide level2">

<p>Los ciclos pueden ser:</p>
<ul>
<li class="fragment">Cíclicos: diseñados para que, cuando se acabe el último frame, empiece el siguiente (andar)</li>
<li class="fragment">Simples: diseñados para que se quede en un estado estacionario (morir)</li>
</ul>
</section><section id="combinando-frames-y-ciclos" class="slide level2">
<h2>Combinando frames y ciclos</h2>
</section><section class="slide level2">

<p>Para combinar frames y ciclos solemos usar una disposición en rejilla</p>
</section><section class="slide level2">

<p>Así, cada fila es un ciclo, y cada columna es un frame del ciclo</p>
</section><section class="slide level2">

<figure>
<img data-src="https://c1.staticflickr.com/5/4147/4998615136_dc0b7b1e39_b.jpg" alt="Spritesheet (https://www.flickr.com/photos/goosemouse/4998615136)" style="width:35.0%" /><figcaption>Spritesheet (https://www.flickr.com/photos/goosemouse/4998615136)</figcaption>
</figure>
</section><section class="slide level2">

<p>Es importante notar que los ciclos no tienen que tener todos los mismos frames</p>
<p>Desde <em>el código</em>, o exportando datos adicionales, se carga la información de:</p>
<ul>
<li class="fragment">El tamaño de cada frame</li>
<li class="fragment">Qué ciclos hay</li>
<li class="fragment">Los frames de cada ciclo</li>
</ul>
</section><section class="slide level2">

<figure>
<img data-src="imgs/frameciclo.jpg" alt="Frames (verde) y ciclos (rojo) (https://www.flickr.com/photos/goosemouse/4998615136)" style="width:35.0%" /><figcaption>Frames (verde) y ciclos (rojo) (https://www.flickr.com/photos/goosemouse/4998615136)</figcaption>
</figure>
<p>(Fijémonos en que el tamaño de frame es distinto en esta imagen: no es cómodo, pero es posible: habría que indicarlo desde código u otro recurso (un JSON))</p>
</section><section id="reusar-ciclos" class="slide level2">
<h2>Reusar ciclos</h2>
</section><section class="slide level2">

<p>Cuando un personaje en 2D se mueve, es muy normal que pueda hacerlo en varias direcciones</p>
</section><section class="slide level2">

<p>Así, en una vista de arriba a abajo, es de esperar que el personaje pueda ir hacia la izquierda, derecha, arriba y abajo</p>
</section><section class="slide level2">

<p>Si tenemos un ciclo de animación en el que el personaje puede ir en una dirección, no tenemos por qué dibujarlo yendo en la contraria, ya que podemos aprovechar la simetría</p>
<p>Haciendo esto, hacemos la imagen espejada por software y la usamos como el ciclo de animación correspondiente</p>
</section><section id="enlazando-los-ciclos" class="slide level2">
<h2>Enlazando los ciclos</h2>
</section><section class="slide level2">

<p>Cuando se crean ciclos, es de esperar que, en el videojuego, se pase de uno a otro de manera “suave”</p>
</section><section class="slide level2">

<p>Esto quiere decir (con un ejemplo práctico) que el personaje tiene que pasar del ciclo de <em>salto</em> al ciclo de <em>andar</em> de una manera fluida</p>
</section><section class="slide level2">

<p>Para hacer esto, se aplica un poco de artesanía al dibujo del sprite, y se pueden aplicar algunas (o varias) de estas técnicas, entre otras:</p>
</section><section class="slide level2">

<ul>
<li class="fragment">se dibujan los principios y finales de las ciclos de manera que sean “neutros” (el personaje en una postura que dé lugar a otros ciclos)</li>
<li class="fragment">se asume un estilo de sprite animado en el que la transición se muestra muy bruscamente</li>
<li class="fragment">se hacen diferentes ciclos de transición:
<ul>
<li class="fragment">se activa andar</li>
<li class="fragment">cuando se deja de andar, se pasa a un ciclo de “parándose”, que no es cíclico</li>
<li class="fragment">cuando se termina el estado “parándose”, se puede activar la animación de “quieto” de forma natural</li>
</ul></li>
<li class="fragment">se anima por huesos (no lo veremos hoy) y se hace la transición de otra forma</li>
</ul>
</section></section>
<section><section id="animación-en-phaser" class="title-slide slide level1"><h1>Animación en Phaser</h1></section><section class="slide level2">

<p>Phaser permite animar mediante secuencias de frames y ciclos, y también mediante animación por esqueleto</p>
</section><section id="cargar-un-spritesheet" class="slide level2">
<h2>Cargar un spritesheet</h2>
<p>Con <a href="https://phaser.io/docs/2.3.0/Phaser.Loader.html#spritesheet"><code class="sourceCode javascript">spritesheet</code></a>:</p>
<pre class="sourceCode javascript" id="cb2"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">// se le da el ancho, alto y cuántos frames</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="va">game</span>.<span class="va">load</span>.<span class="at">spritesheet</span>(<span class="st">&#39;mummy&#39;</span><span class="op">,</span> <span class="st">&#39;assets/sprites/imagen.png&#39;</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">45</span><span class="op">,</span> <span class="dv">18</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">mummy <span class="op">=</span> <span class="va">game</span>.<span class="va">add</span>.<span class="at">sprite</span>(<span class="dv">200</span><span class="op">,</span> <span class="dv">360</span><span class="op">,</span> <span class="st">&#39;mummy&#39;</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span> <span class="co">// &#39;5&#39; es el número de frame</span></a></code></pre>
</section><section id="establecer-un-ciclo-de-animación" class="slide level2">
<h2>Establecer un ciclo de animación</h2>
<p>Se pueden modificar las propiedades de la animación con <a href="http://www.phaser.io/docs/2.6.2/Phaser.AnimationManager.html"><code class="sourceCode javascript">AnimationManager</code></a></p>
<pre class="sourceCode javascript" id="cb3"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">// animations en un AnimationManager</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">anim <span class="op">=</span> <span class="va">mummy</span>.<span class="va">animations</span>.<span class="at">add</span>(<span class="st">&#39;walk&#39;</span>)<span class="op">;</span></a></code></pre>
</section><section id="comenzar-y-detener-la-animación" class="slide level2">
<h2>Comenzar y detener la animación</h2>
</section><section class="slide level2">

<p>Con <code class="sourceCode javascript">play</code> se ejecuta una animación</p>
<p>El primer parámetro es el framerate (frames por segundo, <code class="sourceCode javascript"><span class="kw">null</span></code> para usar el de la animación por defecto)</p>
<p>El segundo parámetro es para hacer “loop”</p>
<pre class="sourceCode javascript" id="cb4"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="va">phoenix</span>.<span class="at">play</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a></code></pre>
</section><section class="slide level2">

<p>Para parar una animación, con <code class="sourceCode javascript">stop</code>:</p>
<pre class="sourceCode javascript" id="cb5"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="va">phoenix</span>.<span class="at">stop</span>()<span class="op">;</span></a></code></pre>
</section><section id="eventos-en-animaciones" class="slide level2">
<h2>Eventos en animaciones</h2>
</section><section class="slide level2">

<p>Es posible hacer “callbacks” para ser informados de cuándo una animación se pone en marcha o se detiene:</p>
<pre class="sourceCode javascript" id="cb6"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="va">anim</span>.<span class="va">onStart</span>.<span class="at">add</span>(animationStarted<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="va">anim</span>.<span class="va">onLoop</span>.<span class="at">add</span>(animationLooped<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="va">anim</span>.<span class="va">onComplete</span>.<span class="at">add</span>(animationStopped<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></a></code></pre>
</section><section class="slide level2">

<p>Con esto, podemos controlar, sin necesidad de conteo de frames a mano, el estado de la animación y actuar en consecuencia:</p>
<pre class="sourceCode javascript" id="cb7"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">function</span> <span class="at">animationLooped</span>(sprite<span class="op">,</span> animation) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    <span class="cf">if</span> (<span class="va">animation</span>.<span class="at">loopCount</span> <span class="op">===</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">        loopText <span class="op">=</span> <span class="va">game</span>.<span class="va">add</span>.<span class="at">text</span>(<span class="dv">32</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> <span class="st">&#39;Animation looped&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">&#39;white&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="op">}</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="cf">else</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    <span class="op">{</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">        <span class="va">loopText</span>.<span class="at">text</span> <span class="op">=</span> <span class="st">&#39;Animation looped x2&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">        <span class="va">animation</span>.<span class="at">loop</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    <span class="op">}</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="op">}</span></a></code></pre>
</section><section id="más-cosas-con-animaciones-por-frames" class="slide level2">
<h2>Más cosas con animaciones por frames</h2>
</section><section class="slide level2">

<p>Saber si la animación sigue funcionando</p>
<pre class="sourceCode javascript" id="cb8"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">function</span> <span class="at">update</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="cf">if</span> (<span class="va">anim</span>.<span class="at">isPlaying</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="op">{</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">        <span class="va">back</span>.<span class="at">x</span> <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="op">}</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="op">}</span></a></code></pre>
</section><section class="slide level2">

<p>Controlar su condición de “loop”</p>
<pre class="sourceCode javascript" id="cb9"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="va">animation</span>.<span class="at">loop</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a></code></pre>
</section></section>
    </div>
  </div>

  <script src="../shared/lib/reveal/lib/js/head.min.js"></script>
  <script src="../shared/lib/reveal/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({

        // Optional reveal.js plugins
        dependencies: [
          { src: '../shared/lib/reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../shared/lib/reveal/plugin/zoom-js/zoom.js', async: true },
          { src: '../shared/lib/reveal/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
