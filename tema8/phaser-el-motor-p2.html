<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>El Motor Físico de Phaser: Fuerzas Físicas, el motor P2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../shared/lib/reveal/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../shared/lib/reveal/css/theme/beige.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../shared/lib/reveal/css/print/pdf.css' : '../shared/lib/reveal/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="../shared/lib/reveal/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">El Motor Físico de Phaser: Fuerzas Físicas, el motor P2</h1>
</section>

<section><section id="colisiones-con-el-motor-p2" class="title-slide slide level1"><h1>Colisiones con el motor P2</h1></section><section class="slide level2">

<p>P2 permite crear colisiones físicas mucho más complejas</p>
<p>Aquí no nos restringimos a unos cuantos tiles que aproximan el objeto como lo que hemos visto en el Ninja engine</p>
<p>Podemos ajustar muchísimo más los bounding boxes de forma que podemos adaptarlos a la forma del sprite</p>
</section><section class="slide level2">

<figure>
<img data-src="imgs/physics-editor-arcade-p2.png" alt="Arcade vs P2" /><figcaption>Arcade vs P2</figcaption>
</figure>
</section><section id="editor-de-físicas" class="slide level2">
<h2>Editor de físicas</h2>
<p>Estas aproximaciones a la forma del sprite no las hace Phaser automáticamente, por lo que debemos crearlas a mano</p>
<p>Existen muchos editores de física 2D, pero uno de los más usados es <a href="https://www.codeandweb.com/physicseditor"><strong>PhysicsEditor</strong></a></p>
</section><section id="physics-editor" class="slide level2">
<h2>Physics Editor</h2>
<p>Permite exportar a múltiples formatos: Unity, Cocos2d, Flash, Corona</p>
<p>En concreto Lime + Corona (JSON) también permite exportar a Phaser ya que es compatible Corona (JSON)</p>
<p>Esto genera un JSON con la descripción de los cuerpos físicos. Los antiguos bounding boxes ahora se convierten en <strong>Shapes</strong></p>
</section><section id="iniciar-p2-engine" class="slide level2">
<h2>Iniciar P2 Engine</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="va">game</span>.<span class="va">physics</span>.<span class="at">startSystem</span>(<span class="va">Phaser</span>.<span class="va">Physics</span>.<span class="at">P2JS</span>)<span class="op">;</span></a></code></pre></div>
</section><section id="cargar-los-poligonos-en-la-física" class="slide level2">
<h2>Cargar los poligonos en la física</h2>
<p>Para añadir la descripción de la física a la cache usamos <code class="sourceCode javascript"><span class="va">load</span>.<span class="at">physics</span></code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="va">game</span>.<span class="va">load</span>.<span class="at">physics</span>(<span class="st">&#39;physicsData&#39;</span><span class="op">,</span> <span class="st">&#39;assets/physics/sprites.json&#39;</span>)<span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<p><a href="https://phaser.io/examples/v2/p2-physics/contact-events">Ejemplo de colisiones con P2</a></p>
</section><section class="slide level2">

<p>Para añadirle una shape a un sprite <code class="sourceCode javascript">loadPolygon</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1">sprite <span class="op">=</span> <span class="va">game</span>.<span class="va">add</span>.<span class="at">sprite</span>(<span class="dv">100</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="st">&#39;Mario&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="va">sprite</span>.<span class="va">body</span>.<span class="at">clearShapes</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="va">sprite</span>.<span class="va">body</span>.<span class="at">loadPolygon</span>(<span class="st">&#39;physicsData&#39;</span><span class="op">,</span> <span class="st">&#39;Mario&#39;</span>)<span class="op">;</span></a></code></pre></div>
</section><section id="añadir-un-cuerpo-a-la-física-y-depuración" class="slide level2">
<h2>Añadir un cuerpo a la física y depuración</h2>
<p><code class="sourceCode javascript">enable</code> permite añadir cuerpos a la física</p>
<p>El segundo atributo si está a <code class="sourceCode javascript"><span class="kw">true</span></code> muestra la información de la forma del collider</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">enable</span>(ship<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></a></code></pre></div>
</section><section id="activar-los-eventos-de-colisión" class="slide level2">
<h2>Activar los eventos de colisión</h2>
<p>Sin ello, la física no generará eventos</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">setImpactEvents</span>(<span class="kw">true</span>)<span class="op">;</span></a></code></pre></div>
</section><section id="chequear-colisiones" class="slide level2">
<h2>Chequear colisiones</h2>
<p>Para chequear los diferentes eventos de colision de un objeto (<code class="sourceCode javascript">onBeginContact</code>, <code class="sourceCode javascript">onEndContact</code>) accedemos a su body físico y cargamos el evento con <code class="sourceCode javascript">add</code></p>
</section><section class="slide level2">

<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="va">block</span>.<span class="va">body</span>.<span class="va">onBeginContact</span>.<span class="at">add</span>(blockHit<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="va">block</span>.<span class="va">body</span>.<span class="va">onEndContact</span> .<span class="at">add</span>(blockHitEnd<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw">function</span> <span class="at">blockHit</span> (bodyA<span class="op">,</span> bodyB<span class="op">,</span> shapeA<span class="op">,</span> shapeB<span class="op">,</span> equation) <span class="op">{}</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="kw">function</span> <span class="at">blockHitEnd</span> (bodyA<span class="op">,</span> bodyB<span class="op">,</span> shapeA<span class="op">,</span> shapeB) <span class="op">{}</span></a></code></pre></div>
<ul>
<li><code class="sourceCode javascript">bodyA</code> y <code class="sourceCode javascript">bodyB</code> son los cuerpos que colisionan</li>
<li><code class="sourceCode javascript">shapeA</code> y <code class="sourceCode javascript">shapeB</code> son sus colliders</li>
<li><code class="sourceCode javascript">equation</code> array con los puntos de contacto</li>
</ul>
</section><section id="grupos-de-colisión" class="slide level2">
<h2>Grupos de colisión</h2>
</section><section class="slide level2">

<p>Permite especificar qué tipos de objetos colisionan con cuales y que evento lo procesará</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">var</span> playerCollisionGroup <span class="op">=</span> <span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">createCollisionGroup</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">var</span> pandaCollisionGroup <span class="op">=</span> <span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">createCollisionGroup</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="va">panda</span>.<span class="va">body</span>.<span class="at">setCollisionGroup</span>(pandaCollisionGroup)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="va">ship</span>.<span class="va">body</span>.<span class="at">setCollisionGroup</span>(playerCollisionGroup)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="va">ship</span>.<span class="va">body</span>.<span class="at">collides</span>(pandaCollisionGroup<span class="op">,</span> hitPanda<span class="op">,</span> <span class="kw">this</span>)<span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">function</span> <span class="at">hitPanda</span>(body1<span class="op">,</span> body2) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    <span class="va">body2</span>.<span class="va">sprite</span>.<span class="at">alpha</span> <span class="op">-=</span> <span class="fl">0.1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="op">}</span></a></code></pre></div>
</section><section id="física-con-tilemaps" class="slide level2">
<h2>Física con tilemaps</h2>
<p>Establecer los tiles colisionables: <code class="sourceCode javascript">setCollision</code>, <code class="sourceCode javascript">setCollisionBetween</code>…</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" data-line-number="1"> <span class="va">map</span>.<span class="at">setCollisionBetween</span>(<span class="dv">1</span><span class="op">,</span> <span class="dv">12</span>)<span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">convertTilemap</span>(map<span class="op">,</span> layer)<span class="op">;</span></a></code></pre></div>
<p>Convierte todos los mapas con tiles cuadrados sin tener en cuenta su transparencia</p>
<p>Si queremos ajustar la forma hay que pasar la información del editor de shape a cada tile como hemos hecho anteriormente</p>
</section><section id="ejemplos-con-p2" class="slide level2">
<h2>Ejemplos con P2</h2>
<p><a href="https://phaser.io/examples/v2/category/p2-physics">Ejemplos con P2 Engine</a></p>
</section></section>
<section><section id="triggers-sensor" class="title-slide slide level1"><h1>Triggers (sensor)</h1></section><section class="slide level2">

<p>Hemos visto colisiones</p>
</section><section class="slide level2">

<p>Ahora veremos una variante de las colisiones que denominamos <strong>Triggers</strong></p>
</section><section class="slide level2">

<p>Los triggers son un método muy utilizado en videojuegos para generar eventos durante el juego</p>
</section><section id="qué-es-un-trigger" class="slide level2">
<h2>¿Qué es un trigger?</h2>
<p>Podemos definir un <strong>trigger</strong> (disparador) como una zona del juego en la que se comprueba que objetos entran y salen de ella, informando de ambos eventos a quienes estén interesados</p>
<p>Normalmente un trigger provoca una invocación a un método asíncrono (evento) asociado a dicho trigger</p>
</section><section class="slide level2">

<p>Al concepto de trigger a veces se le denomina <strong>sensor</strong>. Por ejemplo, ese es el nombre que utiliza Box2D</p>
<p>P2 también utiliza el concepto de sensor</p>
</section><section class="slide level2">

<p>Para establecer que un collider es un sensor, hay que modificar la shape de la física</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="va">sprite</span>.<span class="va">body</span>.<span class="va">data</span>.<span class="at">shapes</span>[<span class="dv">0</span>].<span class="at">sensor</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// Establece que la shape 0 es un sensor</span></a></code></pre></div>
<p>o bien</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" data-line-number="1">triggerShape <span class="op">=</span> <span class="va">trigger</span>.<span class="va">body</span>.<span class="at">addRectangle</span>(<span class="dv">10</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">-54</span>)<span class="op">;</span> <span class="co">//añade un sensor al objeto. Devuelve un shape</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="va">triggerShape</span>.<span class="at">sensor</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// modificamos la shape marcándola como sensor</span></a></code></pre></div>
</section><section class="slide level2">

<p>Al marcarla como sensor, la shape no colisiona con el resto de la física</p>
<p>Por tanto, al objeto se le puede atravesar sin que se produzcan rebotes</p>
</section><section class="slide level2">

<p>Pero podemos seguir escuchando los eventos de contacto</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="va">trigger</span>.<span class="va">body</span>.<span class="va">onBeginContact</span>.<span class="at">add</span>(checkSensorsBegin<span class="op">,</span><span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="va">trigger</span>.<span class="va">body</span>.<span class="va">onEndContact</span>.<span class="at">add</span>(checkSensorsEnd<span class="op">,</span><span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">   </a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">function</span> <span class="at">checkSensorsBegin</span>(bodyA<span class="op">,</span>shapeA<span class="op">,</span>shapeB)<span class="op">{</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="va">game</span>.<span class="va">debug</span>.<span class="at">text</span>(<span class="st">&quot;Collision detected!&quot;</span><span class="op">,</span> <span class="dv">32</span><span class="op">,</span> <span class="dv">32</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="op">}</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="kw">function</span> <span class="at">checkSensorsEnd</span>(bodyA<span class="op">,</span>shapeA<span class="op">,</span>shapeB)<span class="op">{</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    <span class="va">game</span>.<span class="va">debug</span>.<span class="at">text</span>(<span class="st">&quot;Collision left!&quot;</span><span class="op">,</span> <span class="dv">32</span><span class="op">,</span> <span class="dv">32</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="op">}</span></a></code></pre></div>
</section><section class="slide level2">

</section></section>
<section><section id="velocidad" class="title-slide slide level1"><h1>Velocidad</h1></section><section id="qué-es-la-velocidad" class="slide level2">
<h2>¿Qué es la velocidad?</h2>
<!-- https://www.codeandweb.com/physicseditor/tutorials/phaser-p2-physics-example-tutorial -->
</section><section class="slide level2">

<p>La <strong>velocidad</strong> es una magnitud física vectorial que expresa la distancia recorrida de un objeto por unidad de tiempo</p>
<p>Se puede modificar en Phaser directamente en el body físico</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="va">sprite</span>.<span class="va">body</span>.<span class="va">velocity</span>.<span class="at">x</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="va">sprite</span>.<span class="va">body</span>.<span class="va">velocity</span>.<span class="at">y</span></a></code></pre></div>
</section><section class="slide level2">

<p>Si aplicamos una velocidad a un objeto físico este se moverá hacia la dirección indicada con la magnitud indicada</p>
</section><section id="aplicando-fuerzas" class="slide level2">
<h2>Aplicando fuerzas</h2>
</section><section class="slide level2">

<p>Una <strong>fuerza</strong> es todo agente capaz de modificar la cantidad de movimiento de un objeto</p>
<p>En física de videojeugos llamamos fuerza a una modificación constante del movimiento de un objeto</p>
</section><section class="slide level2">

<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="at">applyForce</span>(force<span class="op">,</span> worldX<span class="op">,</span> worldY)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="at">applyForceLocal</span>(force<span class="op">,</span> localX<span class="op">,</span> localY)<span class="op">;</span></a></code></pre></div>
<ul>
<li><code class="sourceCode javascript">force</code>: es un vector 2D (Por ejemplo: <code class="sourceCode javascript">[<span class="dv">200</span><span class="op">,</span> <span class="dv">100</span>]</code>)</li>
<li><code class="sourceCode javascript">worldX</code>, <code class="sourceCode javascript">worldY</code>, <code class="sourceCode javascript">localX</code> y <code class="sourceCode javascript">localY</code> son los punto a partir del cual se está aplicando la fuerza (si no se especifican se toma el centro del mundo o el centro de masas del objeto)</li>
</ul>
</section><section id="aplicando-impulsos" class="slide level2">
<h2>Aplicando impulsos</h2>
<p>Un impulso es una fuerza que se ejerce en un momento puntual pero que cesa y su efecto (la aceleración) sólo ocurre un instante</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="at">applyImpulse</span>(impulse<span class="op">,</span> worldX<span class="op">,</span> worldY)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="at">applyImpulseLocal</span>(impulse<span class="op">,</span> localX<span class="op">,</span> localY)<span class="op">;</span></a></code></pre></div>
<ul>
<li><code class="sourceCode javascript">impulse</code>: es un vector 2D (Por ejemplo: <code class="sourceCode javascript">[<span class="dv">200</span><span class="op">,</span> <span class="dv">100</span>]</code>)</li>
<li><code class="sourceCode javascript">worldX</code>, <code class="sourceCode javascript">worldY</code>, <code class="sourceCode javascript">localX</code> y <code class="sourceCode javascript">localY</code> son los punto a partir del cual se está aplicando la fuerza (si no se especifican se toma el centro del mundo o el centro de masas del objeto)</li>
</ul>
</section><section id="move" class="slide level2">
<h2>Move</h2>
<ul>
<li><code class="sourceCode javascript">moveRight</code>, <code class="sourceCode javascript">moveUp</code>, <code class="sourceCode javascript">moveLeft</code>, <code class="sourceCode javascript">moveDown</code></li>
<li>Mueven el objeto sin necesidad de cambiar la rotación</li>
<li><code class="sourceCode javascript">moveForward</code>, <code class="sourceCode javascript">moveBackward</code></li>
<li>Mueven el objeto en la dirección de rotación del mismo. Si queremos girar tendremos que rotar el objeto</li>
<li><code class="sourceCode javascript">thrust</code>: impulsa el objeto hacia su ángulo de orientación</li>
</ul>
</section><section id="gravedad" class="slide level2">
<h2>Gravedad</h2>
<p>La gravedad es un tipo de fuerza constante hacia una dirección. Normalmente hacia abajo:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="va">gravity</span>.<span class="at">y</span> <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<p>Podemos modificar la fuerza de la gravedad relativa a cada objeto usando <code class="sourceCode javascript">gravityScale</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="va">sprite1</span>.<span class="va">body</span>.<span class="va">data</span>.<span class="at">gravityScale</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="va">sprite2</span>.<span class="va">body</span>.<span class="va">data</span>.<span class="at">gravityScale</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="va">sprite3</span>.<span class="va">body</span>.<span class="va">data</span>.<span class="at">gravityScale</span> <span class="op">=</span> <span class="fl">0.25</span><span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<p><a href="http://phaser.io/examples/v2/p2-physics/gravity-scale">gravityScale</a></p>
</section></section>
<section><section id="aceleración" class="title-slide slide level1"><h1>Aceleración</h1></section><section id="qué-es-la-aceleración" class="slide level2">
<h2>¿Qué es la aceleración?</h2>
<p>La aceleración es una magnitud vectorial que nos indica la variación de velocidad por unidad de tiempo</p>
</section><section id="velocidad-uniformemente-acelerada" class="slide level2">
<h2>Velocidad uniformemente acelerada</h2>
<p><span class="math display">\[v = v_0 + a \times \delta t\]</span></p>
<p>Donde:</p>
<ul>
<li><span class="math inline">\(v\)</span>: velocidad</li>
<li><span class="math inline">\(v_0\)</span>: velocidad inicial</li>
<li><span class="math inline">\(a\)</span>: aceleración</li>
</ul>
</section><section class="slide level2">

<p>El desplazamiento:</p>
<!-- ![Aceleración](imgs/aceleracion.svg) -->
<p><span class="math display">\[e(t) = \frac{1}{2} a t^2 + v_0 t + e_0\]</span></p>
<ul>
<li><span class="math inline">\(e(t)\)</span>: posición</li>
<li><span class="math inline">\(e_0\)</span>: posición inicial</li>
<li><span class="math inline">\(t\)</span>: tiempo</li>
<li><span class="math inline">\(a\)</span>: aceleración</li>
<li><span class="math inline">\(v_0\)</span>: velocidad inicial</li>
</ul>
</section><section class="slide level2">

<p>Una buena aproximación en videojuegos es hacer lo siguiente:</p>
<p><span class="math display">\[e(t+1) = e(t) + v(t) \times t\]</span></p>
<p><span class="math display">\[v(t+1) = \text{min}(v(t) \times a \times t, v_{max})\]</span></p>
<ul>
<li><span class="math inline">\(e(t+1)\)</span>: Siguiente posicion;</li>
<li><span class="math inline">\(e(t)\)</span> : Posición inicial</li>
<li><span class="math inline">\(a\)</span>: Aceleración</li>
<li><span class="math inline">\(v(t+1)\)</span>: Velocidad en la siguiente iteración;</li>
<li><span class="math inline">\(v(t)\)</span>: Velocidad actual</li>
<li><span class="math inline">\(v_{max}\)</span>: Velocidad máxima</li>
</ul>
</section><section id="aceleración-instantánea" class="slide level2">
<h2>Aceleración instantánea</h2>
<p>Si la aceleración es instantanea <span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(v(t) = v_{max}\)</span>;</p>
<p><span class="math display">\[e(t+1) = e(t) + v_{max} \times t\]</span></p>
</section><section id="aceleración-variable" class="slide level2">
<h2>Aceleración variable</h2>
<p>El valor de a puede cambiar en función del tiempo</p>
<p>Por ejemplo en función de cuanto se pulse un gatillo, en función de cuanto se mueva la palanca, en función a una ecuación de aceleración, etc.</p>
</section><section class="slide level2">

<p>Veamos un ejemplo de aceleración usando <code class="sourceCode javascript">force</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">function</span> <span class="at">accelerateToObject</span>(obj1<span class="op">,</span> obj2<span class="op">,</span> speed) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">    <span class="kw">var</span> angle <span class="op">=</span> <span class="va">Math</span>.<span class="at">atan2</span>(<span class="va">obj2</span>.<span class="at">y</span> <span class="op">-</span> <span class="va">obj1</span>.<span class="at">y</span><span class="op">,</span> <span class="va">obj2</span>.<span class="at">x</span> <span class="op">-</span> <span class="va">obj1</span>.<span class="at">x</span>)<span class="op">;</span> <span class="co">//Ángulo de un vector (arcotangente)</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    <span class="va">obj1</span>.<span class="va">body</span>.<span class="at">rotation</span> <span class="op">=</span> angle <span class="op">+</span> <span class="va">game</span>.<span class="va">math</span>.<span class="at">degToRad</span>(<span class="dv">90</span>)<span class="op">;</span>  <span class="co">// corrige el ángulo (-p1/2 a pi/2) =&gt; (0 a 2pi)</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    <span class="va">obj1</span>.<span class="va">body</span>.<span class="va">force</span>.<span class="at">x</span> <span class="op">=</span> <span class="va">Math</span>.<span class="at">cos</span>(angle) <span class="op">*</span> speed<span class="op">;</span> <span class="co">// proyección del ángulo en x * módulo</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    <span class="va">obj1</span>.<span class="va">body</span>.<span class="va">force</span>.<span class="at">y</span> <span class="op">=</span> <span class="va">Math</span>.<span class="at">sin</span>(angle) <span class="op">*</span> speed<span class="op">;</span> <span class="co">// proyección del ángulo en y * módulo</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
<p><a href="http://phaser.io/examples/v2/p2-physics/accelerate-to-object">Aceleración</a></p>
</section><section class="slide level2">

<ul>
<li>El ángulo entre dos vectores se calcula con la arcotangente del vector diferencia (destino–origen)</li>
<li>Si queremos calcular la cantidad de movimiento aplicable a cada componente, debemos proyectar el ángulo a los diferentes componentes</li>
<li>Se usa <code class="sourceCode javascript">thrust</code> para acelerar (al ser un impulso, se aplica la aceleración por física) o force en el caso de los objetos</li>
<li>La rotación es instantánea (en general no tiene por que serlo)</li>
</ul>
</section></section>
<section><section id="constrains" class="title-slide slide level1"><h1>Constrains</h1></section><section id="qué-es-una-constraint" class="slide level2">
<h2>¿Qué es una constraint?</h2>
<p>Una <strong>Constraint</strong> es una restricción al movimiento:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">var</span> constraint <span class="op">=</span> <span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">createDistanceConstraint</span>(sprite1<span class="op">,</span> sprite2<span class="op">,</span> <span class="dv">150</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">var</span> constraint1 <span class="op">=</span> <span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">createGearConstraint</span>(sprite<span class="op">,</span> sprite2<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<ul>
<li><strong>Distance constraint</strong> afecta a la distancia a la que puede estar un objeto de otro: <a href="https://phaser.io/examples/v2/p2-physics/distance-constraint">Distancia</a></li>
<li><strong>Gear constraint</strong> afecta a la velocidad de rotación a la que puede girar un objeto con respecto a otro: <a href="https://phaser.io/examples/v2/p2-physics/gear-constraint">Gear</a></li>
</ul>
</section><section id="joints" class="slide level2">
<h2>Joints</h2>
</section><section class="slide level2">

<p>Son un tipo especial de constraint</p>
<p>Conecta dos cuerpos creando una restricción de rotación</p>
</section><section class="slide level2">

<p>Un objeto rota en función del otro</p>
<p>Esto sirve para construir objetos pendulantes como cuerdas o cadenas</p>
<p>Básicamente cualquier sistema donde el movimiento de uno afecte al movimiento del resto en algún grado</p>
</section><section class="slide level2">

<div class="sourceCode" id="cb21"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">createRevoluteConstraint</span>(bodyA<span class="op">,</span> pivotA<span class="op">,</span> bodyB<span class="op">,</span> pivotB<span class="op">,</span> fuerza)<span class="op">;</span></a></code></pre></div>
<ol>
<li>Objeto padre</li>
<li>Punto de pivote de <span class="math inline">\(A\)</span></li>
<li>Objeto hijo</li>
<li>Punto de pivote de <span class="math inline">\(B\)</span></li>
<li>Fuerza máxima que mantiene a las partes juntas</li>
</ol>
</section><section class="slide level2">

<p><a href="https://phaser.io/examples/v2/p2-physics/chain">Chains</a></p>
</section><section id="springs" class="slide level2">
<h2>Springs</h2>
<p>Los <strong>Springs</strong> o muelles sirven para mantener una distancia flexible a un objeto</p>
<p>Los muelles siguen la ley de <a href="https://es.wikipedia.org/wiki/Ley_de_elasticidad_de_Hooke">Hooke</a> donde la fuerza <span class="math inline">\(F\)</span>:</p>
</section><section class="slide level2">

<!-- ![Ley de Hooke](imgs/hooke.svg) -->
<p><span class="math inline">\(F=-k \times X\)</span></p>
<ul>
<li><span class="math inline">\(k\)</span>: constante de elasticidad <strong>stiffness</strong></li>
<li><span class="math inline">\(X\)</span>: longitud</li>
</ul>
</section><section class="slide level2">

<p>Derivado de esta ley tenemos el movimiento armónico oscilante:</p>
<p>El <strong>damping</strong> es una fuerza que va en dirección contraria al movimiento</p>
<p>La resistencia que hace que el movimiento sea oscilante. Cuanto más estirado esté el muelle, más fuerza de damping se genera</p>
<p>El damping consigue cambiar la dirección del movimiento y como siempre es inverso a este movimiento, lo frena hasta que lo cambia de sentido</p>
</section><section class="slide level2">

<p>En Phaser</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" data-line-number="1">spring <span class="op">=</span> <span class="va">game</span>.<span class="va">physics</span>.<span class="va">p2</span>.<span class="at">createSpring</span>(bodya<span class="op">,</span> bodyb<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></a></code></pre></div>
</section><section class="slide level2">

<ul>
<li><code class="sourceCode javascript">restLength</code>: la longitud del spring</li>
<li><code class="sourceCode javascript">stiffness</code>: rigidez del spring (constante de elasticidad)</li>
<li><code class="sourceCode javascript">damping</code>: amortiguación (rebote o fuerza contraria al movimiento)</li>
</ul>
</section><section class="slide level2">

<p><a href="https://phaser.io/examples/v2/p2-physics/mouse-spring">Springs</a></p>
</section></section>
<section><section id="kinematic-body" class="title-slide slide level1"><h1>Kinematic Body</h1></section><section id="cuerpos-kinemáticos-vs-cuerpos-físicos" class="slide level2">
<h2>Cuerpos Kinemáticos Vs Cuerpos Físicos</h2>
<p><strong>Kinematic bodies</strong> son cuerpos que están en la física, pero que queremos mover nosotros por código</p>
<p>Típicamente las plataformas de los juegos de plataforma</p>
<p>También se suelen incluir los enemigos que son controlados por la IA o el player si no modificamos su posición con la física</p>
</section><section class="slide level2">

<p>En un juego normal, no queremos usar la física para mover un objeto controlado por el jugador o por la IA ya que esto puede provocar muchos problemas</p>
<p>La física es difícil de controlar y produce errores de redondeo</p>
<p>Lo más razonable para garantizar las mecánicas es moverlo nosotros con la lógica del juego</p>
</section><section class="slide level2">

<p>Sin embargo, si que queremos tener colisiones necesitamos que pertenezca a la física de alguna forma</p>
</section><section id="cómo-establecemos-un-cuerpo-kinematic" class="slide level2">
<h2>¿Cómo establecemos un cuerpo <em>kinematic</em>?</h2>
<p>Podemos modificar la propiedad kinematic de body;</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="va">kinematic1</span>.<span class="va">body</span>.<span class="at">kinematic</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a></code></pre></div>
</section><section id="qué-cosas-afectan-a-un-kinematic" class="slide level2">
<h2>¿Qué cosas afectan a un <em>kinematic</em>?</h2>
</section><section class="slide level2">

<ul>
<li>A un objeto kinemático no le afecta la gravedad</li>
<li>Ni los impulsos</li>
<li>Ni las colisiones modifican la velocidad del objeto, es decir un choque impide el paso, pero no modifica la velocidad del objeto, porque la física no puede calcular la velocidad de un objeto kinemático</li>
<li>Sólo podemos preguntar si hemos colisionado con él</li>
<li>O si él ha colisionado con algo</li>
</ul>
</section><section class="slide level2">

<p><a href="https://phaser.io/examples/v2/p2-physics/kinematic-body">Movimientos kinemáticos</a></p>
</section></section>
    </div>
  </div>

  <script src="../shared/lib/reveal/lib/js/head.min.js"></script>
  <script src="../shared/lib/reveal/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: '../shared/lib/reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../shared/lib/reveal/plugin/zoom-js/zoom.js', async: true },
          { src: '../shared/lib/reveal/plugin/math/math.js', async: true },
          { src: '../shared/lib/reveal/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
