<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Carga de recursos con Phaser</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../shared/lib/reveal/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../shared/lib/reveal/css/theme/beige.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? '../shared/lib/reveal/css/print/pdf.css' : '../shared/lib/reveal/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="../shared/lib/reveal/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Carga de recursos con Phaser</h1>
</section>

<section id="introducción" class="slide level1">
<h1>Introducción</h1>
<h2 id="qué-es-phaser">Qué es Phaser</h2>
<p><strong>Phaser</strong> es un framework que nos permite construir juegos en HTML5 para equipos de escritorio y dispositivos móviles. Es bastante nuevo, pero tiene involucrada una apasionada comunidad en el proceso de desarrollo, por lo que crece rápidamente</p>
<p>El juego se renderiza sobre un <em>Canvas</em>, luego no está directamente pensado par ser ejecutado en Node, aunque podemos <em>“apañarlo”</em>.</p>
<h2 id="urls-vs-uris">URLs vs URIs</h2>
</section>
<section class="slide level1">

<p>Las URIs son un superconjunto de las URLs.</p>
<figure>
<img data-src="imgs/URIvsURL.png" alt="URL vs URI" width="400" height="400" /><figcaption>URL vs URI</figcaption>
</figure>
</section>
<section class="slide level1">

<p>Podemos ver la definición de URI en la RFC de <em>Tim Berners-Lee</em> <a href="https://tools.ietf.org/html/rfc3986">RFC 3986: Uniform Resource Identifier (URI)</a></p>
<p>“Uniform Resources Identifier (URI) es una secuencia compacta de caracteres que identifica un recurso abstracto o físico”.</p>
<p>“El nombre de Uniform Resource Locator (URL) es un subconjunto de URIs que además de identificar el recurso, proveen al mismo de una semántica de localización”</p>
<p>Los URNs (Uniform Resource Name) sólo identifican (ej. el nombre de una persona); las URLs también localizan (ej. nos llamamos usando la dirección en la que vivimos).</p>
<!-- Aclararía que las URNs son también un subconjunto de las URIs. Aunque no
hemos hablado de ellas antes y convendría introducirlas en la diapositiva
anterior. -->
</section>
<section class="slide level1">

<p>El directorio especial ../ indica el directorio padre del que se lanzó la aplicación. El directorio ./ indica el directorio de lanzamiento de la aplicación.</p>
<p>Ejemplos:</p>
<ul>
<li><code>ftp://rediris.com/resourcea</code> - URL y URN</li>
<li><code>+34555555555</code> - URN</li>
<li><code>urn:isbn:0451450523</code> - URN</li>
<li><code>http://es.wikipedia.org/wiki/Wikipedia:Portada</code> - URN y URL</li>
</ul>
</section>
<section class="slide level1">

<p>Cómo se crea una URI:</p>
<figure>
<img data-src="imgs/uri.png" alt="Partes de una URI" /><figcaption>Partes de una URI</figcaption>
</figure>
<h2 id="game-states">Game States</h2>
<p>Los estados de Phaser son la unidad mínima que maneja el framework para crear una escena de juego. Podríamos decir que es equivalente a la <em>Scene</em> de Unity.</p>
<p>Piensa en un State como en un capítulo de un libro. Pero <em>sólo un State está activo al mismo tiempo</em>. Podemos cambiar entre estados, pero sólo uno puede estar activo.</p>
</section>
<section class="slide level1">

<!-- Explicaría más la confusión. Supongo que se quiere hacer hincapié en
que los estados no representan individuos. Haría explícito que esta es la
confusión que se quiere evitar. Creo que toda la explicación que sigue está
muy bien. -->
<p>Es decir no podemos declarar un player state, o un Power Up state. Eso son entidades, no states.</p>
<p>Los states no tiene propiedades de visualización. Los States no son objetos renderizables. Son los objetos del State los que son renderizables.</p>
<p>Los States sirven para controlar el flujo de juego.</p>
</section>
<section class="slide level1">

<figure>
<img data-src="imgs/States.png" alt="Ejemplo de State" style="width:50.0%" /><figcaption>Ejemplo de State</figcaption>
</figure>
<h2 id="estructura-de-un-state">Estructura de un State</h2>
</section>
<section class="slide level1">

<p>Un State es un objeto de JavaScript que contiene una serie de métodos ya definidos.</p>
<p>Un estado es válido si hay, al menos, uno de estos métodos: <strong>preload</strong>, <strong>create</strong>, <strong>update</strong> o <strong>render</strong>. Si no existe alguno de estos métodos, Phaser no carga el State.</p>
<!-- Esto es contradictorio. Creo que se ha querido decir que "si no existe
ninguno de estos métodos, Phaser no carga el state". -->
<p>La gestión del State la realiza el <strong>StateManager</strong>. El StateManager es el encargado de gestionar los states. Si no se va a usar un método no es necesario re-declararlo.</p>
</section>
<section class="slide level1">

<figure>
<img data-src="imgs/TimelinePhaser.png" alt="Flujo de ejecución de los métodos de un State" style="width:50.0%" /><figcaption>Flujo de ejecución de los métodos de un State</figcaption>
</figure>
</section>
<section class="slide level1">

<p>Además, Phaser proporciona una serie de propiedades que podemos utilizar en nuestro juego, mayoritariamente, estas propiedades son formas de acceder a los subsistemas de Phaser:</p>
<ul>
<li><strong>game</strong>: La instancia de juego de Phaser.</li>
<li><strong>add</strong>: La factoría de GameObject.</li>
<li><strong>camera</strong>: La cámara.</li>
<li><strong>input</strong>: La entrada de Phaser.</li>
<li><strong>load</strong>: el cargador de recursos.</li>
</ul>
</section>
<section class="slide level1">

<ul>
<li><strong>sound</strong>: el sistema de sonido</li>
<li><strong>state</strong>: el StateManager.</li>
<li><strong>time</strong>: el manager de tiempo.</li>
<li><strong>particles</strong>: el sistema de partículas.</li>
<li><strong>physics</strong>: el sistema de físicas.</li>
</ul>
</section>
<section id="ejemplo-básico-de-un-juego-con-phaser" class="slide level1">
<h1>Ejemplo básico de un juego con Phaser</h1>
</section>
<section class="slide level1">

<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">&lt;html&gt;</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">        <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;UTF-8&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">        <span class="kw">&lt;title&gt;</span>hello phaser!<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;../phaser/build/phaser.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    <span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        <span class="co">// El objeto pasado al final del constructor representa el estado</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        <span class="co">// en el que se iniciará el juego.</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        <span class="kw">var</span> game <span class="op">=</span> <span class="kw">new</span> <span class="va">Phaser</span>.<span class="at">Game</span>(<span class="dv">800</span><span class="op">,</span> <span class="dv">600</span><span class="op">,</span> <span class="va">Phaser</span>.<span class="at">AUTO</span><span class="op">,</span> <span class="st">&#39;&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">          <span class="dt">preload</span><span class="op">:</span> preload<span class="op">,</span> <span class="co">// carga los recursos del estado.</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16">          <span class="dt">create</span><span class="op">:</span> create    <span class="co">// configura la escena.</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">        <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</section>
<section class="slide level1">

<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1">        <span class="kw">function</span> <span class="at">preload</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">          <span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&#39;logo&#39;</span><span class="op">,</span> <span class="st">&#39;phaser.png&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">        <span class="op">}</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">        <span class="kw">function</span> <span class="at">create</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">            <span class="kw">var</span> logo <span class="op">=</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">              <span class="va">game</span>.<span class="va">add</span>.<span class="at">sprite</span>(<span class="va">game</span>.<span class="va">world</span>.<span class="at">centerX</span><span class="op">,</span> <span class="va">game</span>.<span class="va">world</span>.<span class="at">centerY</span><span class="op">,</span> <span class="st">&#39;logo&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">            <span class="va">logo</span>.<span class="va">anchor</span>.<span class="at">setTo</span>(<span class="fl">0.5</span><span class="op">,</span> <span class="fl">0.5</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">        <span class="op">}</span>}<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    &lt;/script<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    &lt;/body<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">&lt;/html<span class="op">&gt;</span></a></code></pre></div>
</section>
<section class="slide level1">

<p>Ejemplo de states:</p>
<!-- En mi opinión, este ejemplo es demasiado complicado. Hemos establecido
que los estados del juego son objetos, no funciones pero sin embargo utilizamos
la versión de `add` que acepta una función. Yo lo dejaría en simples
objetos. -->
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">var</span> boot <span class="op">=</span> <span class="kw">function</span>(game)<span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Comenzando el juego&quot;</span><span class="op">,</span> <span class="st">&quot;color:white; background:red&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="va">boot</span>.<span class="at">prototype</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="dt">preload</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">        <span class="va">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&quot;loading&quot;</span><span class="op">,</span><span class="st">&quot;assets/loading.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="op">},</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    <span class="dt">create</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">        <span class="kw">this</span>.<span class="va">scale</span>.<span class="at">scaleMode</span> <span class="op">=</span> <span class="va">Phaser</span>.<span class="va">ScaleManager</span>.<span class="at">SHOW_ALL</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">        <span class="kw">this</span>.<span class="va">scale</span>.<span class="at">pageAlignHorizontally</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">        <span class="kw">this</span>.<span class="va">scale</span>.<span class="at">setScreenSize</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">state</span>.<span class="at">start</span>(<span class="st">&quot;Preload&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="op">}</span></a></code></pre></div>
</section>
<section class="slide level1">

<!-- Este objeto es muy confuso puesto que se llama como uno de los métodos
del estado. Intentaría buscar un sinónimo. -->
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">var</span> preload <span class="op">=</span> <span class="kw">function</span>(game)<span class="op">{}</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="va">preload</span>.<span class="at">prototype</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="dt">preload</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">        var loadingBar <span class="op">=</span> <span class="kw">this</span>.<span class="va">add</span>.<span class="at">sprite</span>(<span class="dv">160</span><span class="op">,</span><span class="dv">240</span><span class="op">,</span><span class="st">&quot;loading&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">        <span class="va">loadingBar</span>.<span class="va">anchor</span>.<span class="at">setTo</span>(<span class="fl">0.5</span><span class="op">,</span><span class="fl">0.5</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">        <span class="va">this</span>.<span class="va">load</span>.<span class="at">setPreloadSprite</span>(loadingBar)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">spritesheet</span>(<span class="st">&quot;numbers&quot;</span><span class="op">,</span><span class="st">&quot;assets/numbers.png&quot;</span><span class="op">,</span><span class="dv">100</span><span class="op">,</span><span class="dv">100</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&quot;gametitle&quot;</span><span class="op">,</span><span class="st">&quot;assets/gametitle.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&quot;play&quot;</span><span class="op">,</span><span class="st">&quot;assets/play.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&quot;higher&quot;</span><span class="op">,</span><span class="st">&quot;assets/higher.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&quot;lower&quot;</span><span class="op">,</span><span class="st">&quot;assets/lower.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&quot;gameover&quot;</span><span class="op">,</span><span class="st">&quot;assets/gameover.png&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">    <span class="op">},</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    <span class="dt">create</span><span class="op">:</span> <span class="kw">function</span>()<span class="op">{</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">        <span class="kw">this</span>.<span class="va">game</span>.<span class="va">state</span>.<span class="at">start</span>(<span class="st">&quot;GameTitle&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="op">}</span></a></code></pre></div>
</section>
<section class="slide level1">

<p>¿Cómo cargamos esto en la página Web?</p>
<!-- No hemos definido el estado gameTitle y el elemento del DOM "game" no
existe. Faltaría hacer un `start` sobre el estado inicial o el setup se habría
hecho para nada. -->
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" data-line-number="1">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;phaser.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;src/boot.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;src/preload.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">        <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;src/gametitle.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">        <span class="kw">&lt;script&gt;</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">            <span class="va">window</span>.<span class="at">onload</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">                <span class="kw">var</span> game <span class="op">=</span> <span class="kw">new</span> <span class="va">Phaser</span>.<span class="at">Game</span>(<span class="dv">320</span><span class="op">,</span> <span class="dv">480</span><span class="op">,</span> <span class="va">Phaser</span>.<span class="at">CANVAS</span><span class="op">,</span> <span class="st">&quot;game&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">                <span class="va">game</span>.<span class="va">state</span>.<span class="at">add</span>(<span class="st">&quot;Boot&quot;</span><span class="op">,</span>boot)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">                <span class="va">game</span>.<span class="va">state</span>.<span class="at">add</span>(<span class="st">&quot;Preload&quot;</span><span class="op">,</span>preload)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">                <span class="va">game</span>.<span class="va">state</span>.<span class="at">add</span>(<span class="st">&quot;GameTitle&quot;</span><span class="op">,</span>gameTitle)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">            <span class="op">};</span>    </a>
<a class="sourceLine" id="cb5-12" data-line-number="12">        <span class="kw">&lt;/script&gt;</span></a></code></pre></div>
</section>
<section id="localización-de-los-recursos" class="slide level1">
<h1>Localización de los recursos</h1>
<!-- Es de vital importancia que los alumnos aprendan a configurar un servidor
local de donde obtener los recursos. Esta parece la sección ideal puesto que
esto será lo que pase la mayor parte de las veces: que los recursos estarán en
su propio servidor. Explicar CORS es conveniente una vez nos aseguremos que
podemos cargar nuestros propios recursos. -->
</section>
<section class="slide level1">

<p>Para localizar los recursos podemos usar <strong>baseURL</strong> y <em>crossOrigin</em> del subsistema load.</p>
<p><strong>BaseURL</strong> es el lugar donde están los recursos. Si los recursos no están en el mismo sitio que el código podemos establecer aquí la url base para no tener que escribirla constantemente en el método de carga concreto.</p>
</section>
<section class="slide level1">

<p><strong>Cross-origin resource sharing (CORS)</strong> es el mecanismo de control y restricción de recursos que emplean los navegadores cuando un recurso es solicitado por otro dominio. CORS define la forma en la que el navegador debe interactuar con el servidor.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes">MDN de Cross Origin</a></p>
</section>
<section class="slide level1">

<p><strong>anonymous</strong> significa que no hay ningún intercambio de credenciales entre cliente y servidor.</p>
<p><strong>use-credentials</strong> significa que para acceder al recurso hay que tener credenciales.</p>
<p>Algunos ejemplos:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">function</span> <span class="at">preload</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">baseURL</span> <span class="op">=</span> <span class="st">&#39;http://examples.phaser.io/assets/&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="op">}</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">function</span> <span class="at">preload</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    <span class="va">game</span>.<span class="va">stage</span>.<span class="at">backgroundColor</span> <span class="op">=</span> <span class="st">&#39;#85b5e1&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">baseURL</span> <span class="op">=</span> <span class="st">&#39;http://examples.phaser.io/assets/&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
</section>
<section id="carga-de-recursos-en-memoria" class="slide level1">
<h1>Carga de recursos en memoria</h1>
<!-- Sería conveniente hacer referencia a la caché. Sobre todo porque
después nos referiremos a ella durante la liberación de recursos. -->
</section>
<section class="slide level1">

<!-- Convendría recordar que esta función es la misma función `preload`
del ejemplo anterior. O proveer de nuevos ejemplos de estados completos.
Personalmente me inclino más por esta última opción. -->
<p>Una vez que tenemos el origen de los recursos podemos cargarlos en memoria.</p>
<p>Se le añade una <em>key</em> (clave o nombre) al recurso para poder identificarlo.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">function</span> <span class="at">preload</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">baseURL</span> <span class="op">=</span> <span class="st">&#39;http://examples.phaser.io/assets/&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&#39;phaser&#39;</span><span class="op">,</span> <span class="st">&#39;sprites/phaser-dude.png&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
</section>
<section class="slide level1">

<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">function</span> <span class="at">preload</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    <span class="va">game</span>.<span class="va">stage</span>.<span class="at">backgroundColor</span> <span class="op">=</span> <span class="st">&#39;#85b5e1&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">baseURL</span> <span class="op">=</span> <span class="st">&#39;http://examples.phaser.io/assets/&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">crossOrigin</span> <span class="op">=</span> <span class="st">&#39;anonymous&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&#39;player&#39;</span><span class="op">,</span> <span class="st">&#39;sprites/phaser-dude.png&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">image</span>(<span class="st">&#39;platform&#39;</span><span class="op">,</span> <span class="st">&#39;sprites/platform.png&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="op">}</span></a></code></pre></div>
</section>
<section class="slide level1">

<p>Podemos cargar diferentes recursos como: imágenes, archivos JSON, atlas de texturas, video, sonido, tilemaps…</p>
<p>La función <strong>onLoadComplete</strong> nos informa de la finalización de la carga.</p>
<!-- Creo que esto es una señal, no una función. De todas formas, convendría
aclarar en qué contexto hay que usarlo y proveer un ejemplo preciso. -->
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" data-line-number="1">onLoadComplete<span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="kw">this</span>.<span class="at">ready</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="op">}</span></a></code></pre></div>
<p><strong>isLoading</strong> nos informa de que aún estamos cargando recursos.</p>
<!-- De nuevo, habría que especificar el contexto. En este caso el tipo al
que pertenece la propiedad. -->
</section>
<section id="liberación-de-recursos" class="slide level1">
<h1>Liberación de recursos</h1>
</section>
<section class="slide level1">

<p>Si cambiamos de state y no vamos a volver al mismo, es muy probable que haya recursos que ya no utilizaremos nunca. En este caso podemos eliminarlos de la caché. Hay que usar la key asignada en la carga.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="va">cache</span>.<span class="at">removeImage</span>(key)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="va">cache</span>.<span class="at">removeXML</span>(key)</a></code></pre></div>
<!-- Aqué el contexto es muy relevante puesto que no hemos explicado la caché.
Hay que indicar que `cache` es una propiedad del objeto juego. -->
</section>
<section id="sprites-en-phaser" class="slide level1">
<h1>Sprites en Phaser</h1>
</section>
<section class="slide level1">

<p>Son las imágenes 2D que sirven para visualizar los objetos en un juego 2D. En Phaser se instancian así:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" data-line-number="1">player <span class="op">=</span> <span class="va">game</span>.<span class="va">add</span>.<span class="at">sprite</span>(<span class="dv">100</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="st">&#39;player&#39;</span>)<span class="op">;</span></a></code></pre></div>
</section>
<section class="slide level1">

<figure>
<img data-src="imgs/mariosprite.jpg" alt="Sprite" style="height:75.0%" /><figcaption>Sprite</figcaption>
</figure>
<p>Hay que usar la key que se le puso en la carga. El objeto, obviamente, debe estar cargado memoria.</p>
</section>
<section id="spritesheet-o-atlas-de-sprites" class="slide level1">
<h1>Spritesheet o atlas de sprites</h1>
</section>
<section class="slide level1">

<figure>
<img data-src="imgs/mario_spritesheet.gif" alt="Spritesheet o Atlas de Sprites" width="400" height="300" /><figcaption>Spritesheet o Atlas de Sprites</figcaption>
</figure>
</section>
<section class="slide level1">

<p>Sirven para optimizar recursos: * Reduce el número de accesos al servidor (no es lo mismo traerse una imagen grande con muchas imágenes pequeñas que muchas imágenes pequeñas individuales). * Es más eficiente en memoria.</p>
</section>
<section class="slide level1">

<p>Sirve también para crear animaciones por frames.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">function</span> <span class="at">preload</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    <span class="co">//  37x45 is the size of each frame</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="co">//  Hay 18 frames in the PNG</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    <span class="va">game</span>.<span class="va">load</span>.<span class="at">spritesheet</span>(</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">      <span class="st">&#39;mummy&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">      <span class="st">&#39;assets/sprites/metalslug_mummy37x45.png&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">      <span class="dv">37</span><span class="op">,</span> <span class="dv">45</span><span class="op">,</span> <span class="dv">18</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    )<span class="op">;</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"></a>
<a class="sourceLine" id="cb13-11" data-line-number="11"><span class="kw">function</span> <span class="at">create</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">    <span class="kw">var</span> mummy <span class="op">=</span> <span class="va">game</span>.<span class="va">add</span>.<span class="at">sprite</span>(<span class="dv">300</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> <span class="st">&#39;mummy&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    <span class="kw">var</span> walk <span class="op">=</span> <span class="va">mummy</span>.<span class="va">animations</span>.<span class="at">add</span>(<span class="st">&#39;walk&#39;</span>)<span class="op">;</span> <span class="co">//[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15 ...]</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    <span class="va">mummy</span>.<span class="va">animations</span>.<span class="at">play</span>(<span class="st">&#39;walk&#39;</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="op">}</span></a></code></pre></div>
</section>
<section class="slide level1">

<figure>
<img data-src="imgs/mummy.gif" alt="Animation" /><figcaption>Animation</figcaption>
</figure>
</section>
    </div>
  </div>

  <script src="../shared/lib/reveal/lib/js/head.min.js"></script>
  <script src="../shared/lib/reveal/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: '../shared/lib/reveal/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../shared/lib/reveal/plugin/zoom-js/zoom.js', async: true },
          { src: '../shared/lib/reveal/plugin/math/math.js', async: true },
          { src: '../shared/lib/reveal/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
